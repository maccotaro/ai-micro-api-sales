services:
  sales-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ai-micro-api-sales
    ports:
      - "8005:8005"
    environment:
      - SALESDB_URL=postgresql://postgres:password@host.docker.internal:5432/salesdb
      - REDIS_URL=redis://:password@host.docker.internal:6379
      - AUTH_SERVICE_URL=http://host.docker.internal:8002
      - ADMIN_SERVICE_URL=http://host.docker.internal:8003
      - RAG_SERVICE_URL=http://host.docker.internal:8010
      - JWKS_URL=http://host.docker.internal:8002/.well-known/jwks.json
      - JWT_ISSUER=https://auth.example.com
      - JWT_AUDIENCE=fastapi-api
      - OLLAMA_BASE_URL=http://host.docker.internal:11434
      - NEO4J_URI=bolt://host.docker.internal:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=${NEO4J_PASSWORD:-e03ac48d4e1264ead1a0106faff45e8f}
      - NEO4J_DATABASE=neo4j
      - LOG_LEVEL=INFO
      - CORS_ORIGINS=["http://localhost:3005","http://localhost:3003"]
    env_file:
      - .env
    volumes:
      - ./app:/app/app
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8005/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
